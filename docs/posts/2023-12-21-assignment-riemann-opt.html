<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="Marco Zocca" /> 
        <meta name="author" content="Marco Zocca" />
        <title>Marco Zocca - Minimum bipartite matching via Riemann optimization</title>

        <link rel="stylesheet" href="../css/default.css" />

        <link rel="stylesheet" href="../css/highlight_default.min.css">
        <script src="../js/highlight.min.js"></script>
        <script src="../js/haskell.min.js"></script>
        <script>hljs.highlightAll();</script>

        <!--  <script id="MathJax-script" async src="/js/mathjax.min.js"></script> -->
        <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        
    </head>
    <body>


        <div class="container content">

        <header class="masthead">
            <div class="row">
              <div class="col-sm-4">
                    <h2 class="masthead-title">
                      <a href="../index.html" title="Home">Marco Zocca</a>
                </h2>
              </div>
              <div class="col-sm-8">
                    <h4 class="masthead-title" style="text-align: right;">
                      <a href="../about.html" title="About">About</a>
                  &nbsp;
                      <a href="../research.html" title="Research">Research</a>
                  &nbsp;
                      <a href="../oss.html" title="Open source">Open Source</a>
                      <!-- <a class='icon-github-squared' href='/oss.html' title='Open source'>Open Source</a> -->
                  &nbsp;
                      <a href="../archive.html">Posts</a>
                </h4>
              </div>
            </div>
              </header>


        <main role="main">
            <h1>Minimum bipartite matching via Riemann optimization</h1>
            <article class="post">
    <section class="header">
        December 21, 2023
    </section>
    <section>
        <h1 id="introduction">Introduction</h1>
<p><img src="../images/assignment_riemann_tri.png" /></p>
<p>Some time ago I ran into two separate instances of the same optimization problem in the span of a few days, and decided to read up a little on the fundamentals. The two applications were object tracking in videos, and alignment of spectral peaks in chromatography data.</p>
<p>By chasing some definitions, I learned about the Birkhoff theorem. This allows to turn the initial combinatorial optimization problem (<a href="https://math.mit.edu/~goemans/18433S13/matching-notes.pdf">minimum weight bipartite matching <em>aka</em> ‚Äúassignment‚Äù</a> [0]) into a continuous one. The other half of my investigation is about how to turn a constrained continuous optimization problem into an unconstrained one on an appropriate manifold..</p>
<p>In this post I document an experiment which started from a ‚Äúwhat if?‚Äù and ended up connecting some interesting areas of mathematics and computer science.</p>
<h2 id="minimum-bipartite-matching">Minimum bipartite matching</h2>
<p>Given a bipartite graph between two sets <span class="math inline"><em>U</em></span>, <span class="math inline"><em>V</em></span> of <span class="math inline"><em>n</em></span> items each, and an edge cost matrix <span class="math inline"><em>C</em></span> with positive entries, the assignment problem can be written as finding an permutation matrix <span class="math inline"><em>P</em></span> that solves the following problem:</p>
<p><span class="math display">$$
P^{\star} = \underset{P \in \mathbb{P}}{\mathrm{argmin}} \left( P C \right)
$$</span></p>
<p>Recall that a permutation matrix has binary entries, and exactly one <span class="math inline">1</span> per row. The identity matrix can be seen as a trivial permutation that does nothing to its argument, when seen as an operator.</p>
<p>Finding the optimal permutation matrix <span class="math inline"><em>P</em><sup>‚ãÜ</sup></span> is a combinatorial optimization problem that has well known polynomial-time solution algorithms, e.g.¬†Munkres that runs in <span class="math inline"><em>O</em>(<em>n</em><sup>3</sup>)</span> time.</p>
<h1 id="from-discrete-to-continuous">From discrete to continuous</h1>
<p>The Birkhoff-von Neumann theorem states that, in dimension <span class="math inline"><em>n</em></span>, the convex polytope <span class="math inline">ùîπ</span> of doubly convex matrices [1] is the convex hull of the set of <span class="math inline"><em>n</em>‚ÄÖ√ó‚ÄÖ<em>n</em></span> permutation matrices. Informally, there is a convex, continuous region of space ‚Äúbetween‚Äù the permutation matrices of a given dimensionality. This convex set is called the Birkhoff polytope [2].</p>
<p>Can we perhaps use this result to solve the assignment problem with a convex, interior point approach?</p>
<p>We can rewrite the assignment problem such that the optimization variable ranges over the Birkhoff polytope; this rewritten form is equivalent to the original one since the cost function is linear in the argument <span class="math inline"><em>P</em></span>, so we expect the optimum to lie at a vertex of the admissible region <span class="math inline">ùîπ</span> (i.e.¬†to be a permutation matrix).</p>
<p><span class="math display">$$
P^{\star} = \underset{P \in \mathbb{B}}{\mathrm{argmin}} \left( P C \right)
$$</span></p>
<p>What is left to find out is how to turn a constrained optimization problem into an unconstrained one over an appropriate subspace.</p>
<h2 id="the-manifold-of-doubly-stochastic-matrices">The manifold of doubly stochastic matrices</h2>
<p>Informally, a <i>manifold</i> is a version of Euclidean space <span class="math inline">‚Ñù<sup><em>n</em></sup></span> that is only locally flat (unlike regular Euclidean space which is flat everywhere).</p>
<p>The main technical device for moving between <span class="math inline">‚Ñù<sup><em>n</em></sup></span> and a manifold <span class="math inline">ùïÑ</span> is an orthogonal projection. The gradient of our cost function over <span class="math inline">ùïÑ</span> is then expressed as the projection of its gradient computed over <span class="math inline">‚Ñù<sup><em>n</em></sup></span>.</p>
<h2 id="first-order-optimization-on-manifolds">First-order optimization on manifolds</h2>
<p>We use a customized version of <code>mctorch</code> [3], extended to implement the manifold of doubly-stochastic matrices.</p>
<p>At every SGD step, the optimizer checks for</p>
<h1 id="experiments">Experiments</h1>
<p>We start by generating a cost matrix of rank <span class="math inline"><em>n</em></span>, and computing the optimal assignment with the Munkres algorithm, which provides us with a cost lower bound (LB).
We then initialize the SGD optimizer at a random doubly stochastic matrix, with a learning rate 2e-2 (found empirically).</p>
<p><img src="../images/assign_movie_iter-1000_n-10_lr-0.02_1735984842.gif" width="500/"></p>
<p>In the above animation we see the optimal assignment as dashed red edges, superimposed with the temporary solution in blue. As a visual cue, the thickness of the blue edges is proportional to the respective edge coefficient, and we see it both ‚Äúsparsifies‚Äù as it approaches the optimum.</p>
<p><img src="../images/assign_opt_gap_iter-1000_n-10_lr-0.02_1735984842.png" width="400/"></p>
<p>As we can see above, the optimality gap <span class="math inline"><em>y</em>‚ÄÖ‚àí‚ÄÖ<em>y</em><sub><em>M</em><em>u</em><em>n</em><em>k</em><em>r</em><em>e</em><em>s</em></sub></span> decreases smoothly (from most starting points, that is).</p>
<h2 id="code-repo">Code repo</h2>
<p>All scripts can be found on my GitHub profile <a href="https://github.com/ocramz/assignment-riemann-opt">here</a>.</p>
<h1 id="references">References</h1>
<ol start="0" type="1">
<li>Assignment problem <a href="https://en.wikipedia.org/wiki/Assignment_problem">wikipedia</a></li>
<li>Doubly-stochastic matrix <a href="https://en.wikipedia.org/wiki/Doubly_stochastic_matrix">wikipedia</a></li>
<li>Birkhoff polytope <a href="https://en.wikipedia.org/wiki/Birkhoff_polytope">wikipedia</a></li>
<li><code>mctorch</code> <a href="github">https://github.com/mctorch/mctorch</a></li>
<li>Douik, A. and Hassibi, B., Manifold Optimization Over the Set of Doubly Stochastic Matrices: A Second-Order Geometry <a href="https://arxiv.org/abs/1802.02628">arXiv</a></li>
</ol>
    </section>
</article>

        </main>

        <footer>
        </footer>

        </div>


    </body>
</html>
